<!-- 
  Loading Spinner Component
  
  An accessible loading spinner with multiple style variants and proper
  screen reader support. Automatically handles reduced motion preferences.
  
  Usage Examples:
  
  Basic spinner:
  <div class="loading-spinner" aria-label="Loading"></div>
  
  Large spinner with custom message:
  <div class="loading-spinner loading-spinner--lg" aria-label="Loading data">
    <span class="loading-spinner__text">Loading...</span>
  </div>
  
  Inline spinner:
  <button class="btn" disabled>
    <div class="loading-spinner loading-spinner--sm loading-spinner--inline" aria-hidden="true"></div>
    Processing...
  </button>
  
  Overlay spinner:
  <div class="loading-spinner loading-spinner--overlay" aria-label="Loading page content">
    <span class="loading-spinner__text">Please wait...</span>
  </div>
  
  Custom color spinner:
  <div class="loading-spinner loading-spinner--primary" aria-label="Saving"></div>
-->

<div 
  class="loading-spinner" 
  role="status" 
  aria-label="Loading"
  aria-live="polite"
>
  <div class="loading-spinner__element">
    <!-- Spinner visual element -->
    <svg 
      class="loading-spinner__svg" 
      viewBox="0 0 50 50"
      aria-hidden="true"
    >
      <circle 
        class="loading-spinner__track" 
        cx="25" 
        cy="25" 
        r="20" 
        fill="none" 
        stroke="currentColor" 
        stroke-width="4"
      />
      <circle 
        class="loading-spinner__progress" 
        cx="25" 
        cy="25" 
        r="20" 
        fill="none" 
        stroke="currentColor" 
        stroke-width="4" 
        stroke-linecap="round"
      />
    </svg>
  </div>
  
  <!-- Optional text label -->
  <span class="loading-spinner__text" aria-hidden="true">
    Loading...
  </span>
</div>

<style>
  .loading-spinner {
    /* CSS Custom Properties for theming */
    --spinner-size: 2rem;
    --spinner-color: var(--color-primary, #2563eb);
    --spinner-track-color: var(--color-border, #e2e8f0);
    --spinner-speed: 1.4s;
    --spinner-text-color: var(--color-text-muted, #64748b);
    --spinner-gap: var(--spacing-sm, 0.5rem);
    
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--spinner-gap);
    font-family: var(--font-family-primary, system-ui, -apple-system, sans-serif);
  }
  
  .loading-spinner__element {
    width: var(--spinner-size);
    height: var(--spinner-size);
    position: relative;
  }
  
  .loading-spinner__svg {
    width: 100%;
    height: 100%;
    transform-origin: center;
    animation: loading-spinner-rotate var(--spinner-speed) linear infinite;
  }
  
  .loading-spinner__track {
    opacity: 0.2;
    stroke: var(--spinner-track-color);
  }
  
  .loading-spinner__progress {
    stroke: var(--spinner-color);
    stroke-dasharray: 90, 150;
    stroke-dashoffset: 0;
    animation: loading-spinner-dash calc(var(--spinner-speed) * 1.5) ease-in-out infinite;
  }
  
  .loading-spinner__text {
    font-size: var(--font-size-sm, 0.875rem);
    color: var(--spinner-text-color);
    font-weight: var(--font-weight-medium, 500);
    text-align: center;
    margin: 0;
  }
  
  /* Size variants */
  .loading-spinner--xs {
    --spinner-size: 1rem;
    --spinner-gap: 0.25rem;
  }
  
  .loading-spinner--xs .loading-spinner__text {
    font-size: var(--font-size-xs, 0.75rem);
  }
  
  .loading-spinner--sm {
    --spinner-size: 1.5rem;
    --spinner-gap: 0.375rem;
  }
  
  .loading-spinner--lg {
    --spinner-size: 3rem;
    --spinner-gap: var(--spacing-md, 1rem);
  }
  
  .loading-spinner--lg .loading-spinner__text {
    font-size: var(--font-size-lg, 1.125rem);
  }
  
  .loading-spinner--xl {
    --spinner-size: 4rem;
    --spinner-gap: var(--spacing-lg, 1.5rem);
  }
  
  .loading-spinner--xl .loading-spinner__text {
    font-size: var(--font-size-xl, 1.25rem);
  }
  
  /* Color variants */
  .loading-spinner--primary {
    --spinner-color: var(--color-primary, #2563eb);
  }
  
  .loading-spinner--secondary {
    --spinner-color: var(--color-secondary, #64748b);
  }
  
  .loading-spinner--accent {
    --spinner-color: var(--color-accent, #f59e0b);
  }
  
  .loading-spinner--success {
    --spinner-color: var(--color-success, #16a34a);
  }
  
  .loading-spinner--warning {
    --spinner-color: var(--color-warning, #d97706);
  }
  
  .loading-spinner--error {
    --spinner-color: var(--color-error, #dc2626);
  }
  
  /* Style variants */
  .loading-spinner--inline {
    flex-direction: row;
    display: inline-flex;
  }
  
  .loading-spinner--text-only .loading-spinner__element {
    display: none;
  }
  
  .loading-spinner--no-text .loading-spinner__text {
    display: none;
  }
  
  /* Overlay variant */
  .loading-spinner--overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    z-index: var(--z-modal, 1050);
    backdrop-filter: blur(2px);
  }
  
  .loading-spinner--overlay-dark {
    background: rgba(0, 0, 0, 0.8);
    --spinner-track-color: rgba(255, 255, 255, 0.2);
    --spinner-text-color: rgba(255, 255, 255, 0.9);
  }
  
  /* Dots variant */
  .loading-spinner--dots .loading-spinner__element {
    display: flex;
    gap: 0.25rem;
  }
  
  .loading-spinner--dots .loading-spinner__svg {
    display: none;
  }
  
  .loading-spinner--dots .loading-spinner__element::before,
  .loading-spinner--dots .loading-spinner__element::after {
    content: '';
    width: 0.5rem;
    height: 0.5rem;
    background: var(--spinner-color);
    border-radius: 50%;
    animation: loading-spinner-dots var(--spinner-speed) infinite ease-in-out;
  }
  
  .loading-spinner--dots .loading-spinner__element::before {
    animation-delay: -0.32s;
  }
  
  .loading-spinner--dots .loading-spinner__element::after {
    animation-delay: -0.16s;
  }
  
  /* Pulse variant */
  .loading-spinner--pulse .loading-spinner__svg {
    animation: loading-spinner-pulse var(--spinner-speed) infinite ease-in-out;
  }
  
  /* Animations */
  @keyframes loading-spinner-rotate {
    to {
      transform: rotate(360deg);
    }
  }
  
  @keyframes loading-spinner-dash {
    0% {
      stroke-dasharray: 1, 150;
      stroke-dashoffset: 0;
    }
    50% {
      stroke-dasharray: 90, 150;
      stroke-dashoffset: -35;
    }
    100% {
      stroke-dasharray: 90, 150;
      stroke-dashoffset: -124;
    }
  }
  
  @keyframes loading-spinner-dots {
    0%, 80%, 100% {
      transform: scale(0);
      opacity: 0.5;
    }
    40% {
      transform: scale(1);
      opacity: 1;
    }
  }
  
  @keyframes loading-spinner-pulse {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(0.8);
    }
  }
  
  /* Accessibility: Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .loading-spinner__svg {
      animation: loading-spinner-pulse 2s infinite ease-in-out;
    }
    
    .loading-spinner__progress {
      animation: none;
      stroke-dasharray: none;
      opacity: 0.5;
    }
    
    .loading-spinner--dots .loading-spinner__element::before,
    .loading-spinner--dots .loading-spinner__element::after {
      animation: loading-spinner-pulse 2s infinite ease-in-out;
    }
  }
  
  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .loading-spinner {
      --spinner-color: ButtonText;
      --spinner-track-color: ButtonFace;
      --spinner-text-color: ButtonText;
    }
  }
  
  /* Print styles */
  @media print {
    .loading-spinner {
      display: none;
    }
  }
</style>

<script>
  // Loading Spinner Component JavaScript
  (function() {
    'use strict';
    
    class LoadingSpinner {
      constructor(element) {
        this.element = element;
        this.textElement = element.querySelector('.loading-spinner__text');
        this.isVisible = true;
        this.originalText = this.textElement ? this.textElement.textContent : '';
        
        this.init();
      }
      
      init() {
        // Set up accessibility attributes
        if (!this.element.getAttribute('role')) {
          this.element.setAttribute('role', 'status');
        }
        
        if (!this.element.getAttribute('aria-live')) {
          this.element.setAttribute('aria-live', 'polite');
        }
      }
      
      show(text) {
        this.element.style.display = 'flex';
        this.isVisible = true;
        
        if (text && this.textElement) {
          this.textElement.textContent = text;
        }
        
        // Announce to screen readers
        this.element.setAttribute('aria-busy', 'true');
      }
      
      hide() {
        this.element.style.display = 'none';
        this.isVisible = false;
        this.element.setAttribute('aria-busy', 'false');
        
        // Restore original text
        if (this.textElement && this.originalText) {
          this.textElement.textContent = this.originalText;
        }
      }
      
      setText(text) {
        if (this.textElement) {
          this.textElement.textContent = text;
        }
      }
      
      setSize(size) {
        // Remove existing size classes
        this.element.classList.remove(
          'loading-spinner--xs',
          'loading-spinner--sm', 
          'loading-spinner--lg',
          'loading-spinner--xl'
        );
        
        // Add new size class
        if (size !== 'default') {
          this.element.classList.add(`loading-spinner--${size}`);
        }
      }
      
      setColor(color) {
        // Remove existing color classes
        this.element.classList.remove(
          'loading-spinner--primary',
          'loading-spinner--secondary',
          'loading-spinner--accent',
          'loading-spinner--success',
          'loading-spinner--warning',
          'loading-spinner--error'
        );
        
        // Add new color class
        if (color !== 'default') {
          this.element.classList.add(`loading-spinner--${color}`);
        }
      }
      
      destroy() {
        this.hide();
      }
    }
    
    // Auto-initialize all loading spinners
    function initSpinners() {
      const spinners = document.querySelectorAll('.loading-spinner');
      spinners.forEach(spinner => {
        if (!spinner._loadingSpinner) {
          spinner._loadingSpinner = new LoadingSpinner(spinner);
        }
      });
    }
    
    // Utility functions for creating spinners programmatically
    function createSpinner(options = {}) {
      const {
        size = 'default',
        color = 'default',
        text = 'Loading...',
        variant = 'default',
        inline = false
      } = options;
      
      const spinner = document.createElement('div');
      spinner.className = 'loading-spinner';
      spinner.setAttribute('role', 'status');
      spinner.setAttribute('aria-label', text);
      spinner.setAttribute('aria-live', 'polite');
      
      // Add size class
      if (size !== 'default') {
        spinner.classList.add(`loading-spinner--${size}`);
      }
      
      // Add color class
      if (color !== 'default') {
        spinner.classList.add(`loading-spinner--${color}`);
      }
      
      // Add variant class
      if (variant !== 'default') {
        spinner.classList.add(`loading-spinner--${variant}`);
      }
      
      // Add inline class
      if (inline) {
        spinner.classList.add('loading-spinner--inline');
      }
      
      // Create spinner structure
      spinner.innerHTML = `
        <div class="loading-spinner__element">
          <svg class="loading-spinner__svg" viewBox="0 0 50 50" aria-hidden="true">
            <circle class="loading-spinner__track" cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="4"/>
            <circle class="loading-spinner__progress" cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
          </svg>
        </div>
        <span class="loading-spinner__text" aria-hidden="true">${text}</span>
      `;
      
      return new LoadingSpinner(spinner);
    }
    
    // Global API
    window.LoadingSpinner = {
      create: createSpinner,
      init: initSpinners
    };
    
    // Auto-initialize on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initSpinners);
    } else {
      initSpinners();
    }
  })();
</script>